/root/Codes/part3/rnn/data.py:358: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  tensor_data = torch.load(f'{input_dir}/tensor_data.pt')
tensor([[ 0.0000e+00,  1.0000e+00,  0.0000e+00,  ...,  1.0000e+00,
          0.0000e+00,  1.0000e+00],
        [ 8.4147e-01,  5.4030e-01,  6.8156e-01,  ...,  1.0000e+00,
          1.3335e-04,  1.0000e+00],
        [ 9.0930e-01, -4.1615e-01,  9.9748e-01,  ...,  1.0000e+00,
          2.6670e-04,  1.0000e+00],
        ...,
        [ 9.0179e-01, -4.3218e-01,  6.2345e-02,  ...,  9.9997e-01,
          6.1342e-03,  9.9998e-01],
        [ 1.2357e-01, -9.9234e-01, -6.3461e-01,  ...,  9.9997e-01,
          6.2675e-03,  9.9998e-01],
        [-7.6825e-01, -6.4014e-01, -9.9112e-01,  ...,  9.9996e-01,
          6.4009e-03,  9.9998e-01]])
Parameters: 2.89M
LlamaForCausalLM(
  (model): LlamaModel(
    (embed_tokens): Embedding(49, 64)
    (layers): ModuleList(
      (0-15): 16 x LlamaDecoderLayer(
        (self_attn): LlamaSdpaAttention(
          (q_proj): Linear(in_features=64, out_features=512, bias=False)
          (k_proj): Linear(in_features=64, out_features=512, bias=False)
          (v_proj): Linear(in_features=64, out_features=512, bias=False)
          (o_proj): Linear(in_features=512, out_features=64, bias=False)
          (rotary_emb): LlamaRotaryEmbedding()
        )
        (mlp): LlamaMLP(
          (gate_proj): Linear(in_features=64, out_features=256, bias=False)
          (up_proj): Linear(in_features=64, out_features=256, bias=False)
          (down_proj): Linear(in_features=256, out_features=64, bias=False)
          (act_fn): SiLU()
        )
        (input_layernorm): LlamaRMSNorm((64,), eps=1e-05)
        (post_attention_layernorm): LlamaRMSNorm((64,), eps=1e-05)
      )
    )
    (norm): LlamaRMSNorm((64,), eps=1e-05)
    (rotary_emb): LlamaRotaryEmbedding()
  )
  (lm_head): Linear(in_features=64, out_features=49, bias=False)
)
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:03<00:00, 24.07it/s]
Initial | val loss: 13.005869515334503 | val acc: 0.0
start training
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.44it/s]
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.40it/s]
Step 0.0 | Train loss | 13.159917831420898 | Samples 0 | Train acc: 0.0 | Val loss: 13.005869515334503 | Val acc: 0.0 | learning rate: 6.41025641025641e-07
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 29.26it/s]
Step 78.25 | Train loss | 4.8474157570274015 | Samples 20032 | Train acc: 0.0 | Val loss: 3.5633273818824867 | Val acc: 0.0 | learning rate: 9.999898676885025e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.50it/s]
Step 156.25 | Train loss | 1.5580470276335938 | Samples 40000 | Train acc: 0.0 | Val loss: 2.570435216155233 | Val acc: 0.0 | learning rate: 9.999103441644837e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.48it/s]
Step 234.5 | Train loss | 0.7138614881787692 | Samples 60032 | Train acc: 0.0 | Val loss: 2.022283691394178 | Val acc: 0.0 | learning rate: 9.997511811226003e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.43it/s]
Step 312.5 | Train loss | 0.4951023772466097 | Samples 80000 | Train acc: 0.0 | Val loss: 1.9575433565091482 | Val acc: 0.0 | learning rate: 9.995134207194224e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.43it/s]
Step 390.75 | Train loss | 0.38577078926898634 | Samples 100032 | Train acc: 0.0 | Val loss: 1.9094270618656013 | Val acc: 0.0 | learning rate: 9.991955766863001e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.51it/s]
Step 468.75 | Train loss | 0.3151411102143432 | Samples 120000 | Train acc: 0.0 | Val loss: 1.8890863174124608 | Val acc: 0.0 | learning rate: 9.987997301800362e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.51it/s]
Step 547.0 | Train loss | 0.2673165404453513 | Samples 140032 | Train acc: 0.0 | Val loss: 1.843363802644271 | Val acc: 0.0 | learning rate: 9.983234067168876e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.38it/s]
Step 625.0 | Train loss | 0.22718253387350504 | Samples 160000 | Train acc: 0.0 | Val loss: 1.791113957574096 | Val acc: 0.0 | learning rate: 9.977697251341214e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.46it/s]
Step 703.25 | Train loss | 0.1935336216595805 | Samples 180032 | Train acc: 0.0 | Val loss: 1.687029390395442 | Val acc: 0.0 | learning rate: 9.971352243020988e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.45it/s]
Step 781.25 | Train loss | 0.161850001479446 | Samples 200000 | Train acc: 0.0 | Val loss: 1.5419810527487645 | Val acc: 0.0 | learning rate: 9.964240587607363e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.49it/s]
Step 859.5 | Train loss | 0.1370765017575738 | Samples 220032 | Train acc: 9.984025559105431e-05 | Val loss: 1.4484527111053467 | Val acc: 0.0008 | learning rate: 9.956317829293786e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.37it/s]
Step 937.5 | Train loss | 0.11719668884018014 | Samples 240000 | Train acc: 0.0006510416666666666 | Val loss: 1.3511976229993603 | Val acc: 0.0034 | learning rate: 9.947635844159853e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.41it/s]
Step 1015.75 | Train loss | 0.10051954921892309 | Samples 260032 | Train acc: 0.0027456070287539937 | Val loss: 1.2262100162385385 | Val acc: 0.0074 | learning rate: 9.938140360080557e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.45it/s]
Step 1093.75 | Train loss | 0.0850958441413081 | Samples 280000 | Train acc: 0.006560496794871795 | Val loss: 1.1291964959494676 | Val acc: 0.0074 | learning rate: 9.927893550918636e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.42it/s]
Step 1172.0 | Train loss | 0.07197266573030371 | Samples 300032 | Train acc: 0.00983426517571885 | Val loss: 1.0610487966597835 | Val acc: 0.0122 | learning rate: 9.916831362647369e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 29.27it/s]
Step 1250.0 | Train loss | 0.05923899626212224 | Samples 320000 | Train acc: 0.015174278846153846 | Val loss: 0.8423600468454482 | Val acc: 0.0282 | learning rate: 9.905026227484999e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.45it/s]
Step 1328.25 | Train loss | 0.047294480250121326 | Samples 340032 | Train acc: 0.02630790734824281 | Val loss: 0.7060601620734492 | Val acc: 0.0306 | learning rate: 9.892404350123039e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.46it/s]
Step 1406.25 | Train loss | 0.03755215904783024 | Samples 360000 | Train acc: 0.03786057692307692 | Val loss: 0.6257286788542059 | Val acc: 0.0392 | learning rate: 9.879048375202247e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.51it/s]
Step 1484.5 | Train loss | 0.031100368129422237 | Samples 380032 | Train acc: 0.046475638977635784 | Val loss: 0.5400068658062175 | Val acc: 0.061 | learning rate: 9.864874812929762e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.39it/s]
Step 1562.5 | Train loss | 0.025796878916647812 | Samples 400000 | Train acc: 0.058994391025641024 | Val loss: 0.4912565324125411 | Val acc: 0.0928 | learning rate: 9.849976467959655e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.45it/s]
Step 1640.75 | Train loss | 0.02187069579459486 | Samples 420032 | Train acc: 0.07293330670926518 | Val loss: 0.4334885285624975 | Val acc: 0.0768 | learning rate: 9.834260208959848e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.45it/s]
Step 1718.75 | Train loss | 0.019308628918578142 | Samples 440000 | Train acc: 0.09029447115384616 | Val loss: 0.37832079205331925 | Val acc: 0.1176 | learning rate: 9.81782894174553e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 29.60it/s]
Step 1797.0 | Train loss | 0.016383572245924308 | Samples 460032 | Train acc: 0.10967452076677316 | Val loss: 0.3427681021298034 | Val acc: 0.1194 | learning rate: 9.800579952504767e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.48it/s]
Step 1875.0 | Train loss | 0.013748184504023934 | Samples 480000 | Train acc: 0.11929086538461539 | Val loss: 0.3953041845484625 | Val acc: 0.0768 | learning rate: 9.782626182956005e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.49it/s]
Step 1953.25 | Train loss | 0.012020450238913625 | Samples 500032 | Train acc: 0.136930910543131 | Val loss: 0.2799341486224645 | Val acc: 0.1432 | learning rate: 9.763855401943554e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.55it/s]
Step 2031.25 | Train loss | 0.010555823184338925 | Samples 520000 | Train acc: 0.1521935096153846 | Val loss: 0.2524459216790863 | Val acc: 0.1372 | learning rate: 9.74439051546698e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.50it/s]
Step 2109.5 | Train loss | 0.008931815354077366 | Samples 540032 | Train acc: 0.17202476038338657 | Val loss: 0.20286465464513512 | Val acc: 0.2002 | learning rate: 9.724109846198368e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.47it/s]
Step 2187.5 | Train loss | 0.00746878465132473 | Samples 560000 | Train acc: 0.19476161858974358 | Val loss: 0.18761233589317225 | Val acc: 0.1982 | learning rate: 9.703146186477403e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.45it/s]
Step 2265.75 | Train loss | 0.00665402212504886 | Samples 580032 | Train acc: 0.21041333865814696 | Val loss: 0.1756871740652036 | Val acc: 0.2196 | learning rate: 9.681368489965787e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.47it/s]
Step 2343.75 | Train loss | 0.005810469193479408 | Samples 600000 | Train acc: 0.23272235576923078 | Val loss: 0.1852983034487012 | Val acc: 0.2016 | learning rate: 9.658919351132882e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.47it/s]
Step 2422.0 | Train loss | 0.005152284335439229 | Samples 620032 | Train acc: 0.25189696485623003 | Val loss: 0.1617453337847432 | Val acc: 0.2446 | learning rate: 9.635658437733217e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.32it/s]
Step 2500.0 | Train loss | 0.004528431580366104 | Samples 640000 | Train acc: 0.27098357371794873 | Val loss: 0.13726035373497614 | Val acc: 0.2762 | learning rate: 9.611738055939361e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.46it/s]
Step 2578.25 | Train loss | 0.004145771238302015 | Samples 660032 | Train acc: 0.288538338658147 | Val loss: 0.11845586533787884 | Val acc: 0.3492 | learning rate: 9.587008676590546e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.53it/s]
Step 2656.25 | Train loss | 0.003624431833094759 | Samples 680000 | Train acc: 0.31430288461538464 | Val loss: 0.11374785826553273 | Val acc: 0.3124 | learning rate: 9.56163222097739e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.42it/s]
Step 2734.5 | Train loss | 0.00324669389805265 | Samples 700032 | Train acc: 0.330870607028754 | Val loss: 0.09856566532125956 | Val acc: 0.391 | learning rate: 9.535450057847943e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.48it/s]
Step 2812.5 | Train loss | 0.0029576967800048156 | Samples 720000 | Train acc: 0.3551682692307692 | Val loss: 0.10405132193354112 | Val acc: 0.349 | learning rate: 9.508633620928274e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.43it/s]
Step 2890.75 | Train loss | 0.002605772261523594 | Samples 740032 | Train acc: 0.3823382587859425 | Val loss: 0.08526111229122439 | Val acc: 0.4244 | learning rate: 9.481015277471463e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.79it/s]
Step 2968.75 | Train loss | 0.0024211259051259014 | Samples 760000 | Train acc: 0.3939803685897436 | Val loss: 0.08745362807678271 | Val acc: 0.4254 | learning rate: 9.452775864924108e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.49it/s]
Step 3047.0 | Train loss | 0.0023903559438901985 | Samples 780032 | Train acc: 0.40605031948881787 | Val loss: 0.09716175619182707 | Val acc: 0.3702 | learning rate: 9.423738855348851e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.48it/s]
Step 3125.0 | Train loss | 0.0020336832557046104 | Samples 800000 | Train acc: 0.4303886217948718 | Val loss: 0.06877587862972971 | Val acc: 0.4678 | learning rate: 9.394094375234508e-05
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 79/79 [00:02<00:00, 28.34it/s]
Step 3203.25 | Train loss | 0.0024400900267919287 | Samples 820032 | Train acc: 0.4113917731629393 | Val loss: 0.07704120483013648 | Val acc: 0.4186 | learning rate: 9.363657113398708e-05
 17%|██████████████████████████████████▉                                                                                                                                                                           | 13235/78125 [22:34<1:41:14, 10.68it/s]Traceback (most recent call last):
Step 3281.25 | Train loss | 0.0016236679218953546 | Samples 840000 | Train acc: 0.47375801282051283 | Val loss: 0.06861666321188589 | Val acc: 0.4758 | learning rate: 9.332626364803526e-05
  File "rnn/train_trans.py", line 242, in <module>
    main()
  File "rnn/train_trans.py", line 239, in main
    train(model, optimizer, scheduler, train_loader, val_loader, args)
  File "rnn/train_trans.py", line 94, in train
    optimizer.step()
  File "/root/miniconda3/lib/python3.8/site-packages/torch/optim/lr_scheduler.py", line 130, in wrapper
    return func.__get__(opt, opt.__class__)(*args, **kwargs)
  File "/root/miniconda3/lib/python3.8/site-packages/torch/optim/optimizer.py", line 469, in wrapper
    with torch.autograd.profiler.record_function(profile_name):
  File "/root/miniconda3/lib/python3.8/site-packages/torch/autograd/profiler.py", line 676, in __init__
    def __init__(self, name: str, args: Optional[str] = None):
KeyboardInterrupt
